function xpeak();
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% xpeak.m                                   %
% GUI version of hsvd peak removal          %
% DK Deelchand March 2007                   %
% Updated Aug 2007			    %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

h1 = figure(...     
    'Units','characters',... 
    'MenuBar','none',...
    'Name','Peak Removal using HSVD (2007)',...
    'NumberTitle','off',...     'Position',[29.0000    9.2308  150.2000   40.3846],...%  
     'Position',[4.8   30  130 38],...   
    'Tag','figure1');

setappdata(h1, 'GUIDEOptions', struct(...
    'active_h', 1.160006e+002, ...
    'taginfo', struct(...
    'figure', 2, ...
    'pushbutton', 18, ...
    'text', 56, ...
    'edit', 34, ...
    'frame', 21, ...
    'radiobutton', 11, ...
    'togglebutton', 3, ...
    'listbox', 3, ...
    'popupmenu', 7, ...
    'checkbox', 2), ...
    'override', 0, ...
    'release', 13, ...
    'resize', 'none', ...
    'accessibility', 'callback', ...
    'mfile', 1, ...
    'callbacks', 1, ...
    'singleton', 1, ...
    'syscolorfig', 1));

setappdata(h1, 'UsedByGUIData_m', struct(...
    'figure1', 1.770002e+002, ...
    'text1', 5.000366e+000, ...
    'pushbutton1', 1.020011e+002, ...
    'output', 1.770002e+002));

%% Filename %%
hfile = uicontrol(...
    'Parent',h1,...
    'Units','normalized',...
    'Callback',[...
        'dir1=pwd; dir1=uigetdir(dir1,''Select a directory'');' ,...
        'set(findobj(''Style'',''edit'',''Tag'',''filename''),''String'',dir1);'],...
    'CData',zeros(1,0),...
    'ListboxTop',0,...
    'Position',[0.118508655126498 0.796407185628742 0.14780292942743 0.06187624750499],...
    'String','BROWSE',...
    'Tag','filer',...
    'UserData',zeros(1,0));

hfile1 = uicontrol(...
    'Parent',h1,...
    'Units','normalized',...
    'BackgroundColor',[1 1 1],...
    'Callback','',...
    'CData',zeros(1,0),...
    'ListboxTop',0,...
    'Position',[0.264980026631158 0.796407185628742 0.652463382157124 0.0718562874251497],...
    'String', '',...
    'FontName','Arial',...
    'FontSize',13,...
    'Style','edit',...
    'Tag','filename',...
    'UserData',zeros(1,0));


%% RDB %%
hrdb = uicontrol(...
    'Parent',h1,...
    'Units','normalized',...
    'CData',zeros(1,0),...
    'ListboxTop',0,...
    'Position',[0.0652463382157124 0.403193612774451 0.210386151797603 0.285429141716567],...
    'String',{ '' },...
    'Style','frame',...
    'Tag','frame19',...
    'UserData',zeros(1,0));

hrdb1 = uicontrol(...
    'Parent',h1,...
    'Units','normalized',...
    'CData',zeros(1,0),...
    'FontSize',13,...
    'FontWeight','bold',...
    'ListboxTop',0,...
    'Position',[0.131824234354194 0.612754491017964 0.0878828229027963 0.0698602794411178],...
    'String','RDB',...
    'Style','text',...
    'Tag','text53',...
    'UserData',zeros(1,0));

hrdb2 = uicontrol(...
    'Parent',h1,...
    'Units','normalized',...
    'CData',zeros(1,0),...
    'FontSize',10,...
    'HorizontalAlignment','left',...
    'ListboxTop',0,...
    'Position',[0.099866844207723 0.542914171656686 0.14780292942743 0.0778443113772454],...
    'String','Create RDB file',...
    'Style','radiobutton',...
    'Value',1,...
    'Tag','createrdb',...
    'UserData',zeros(1,0));

hrdb3 = uicontrol(...
    'Parent',h1,...
    'Units','normalized',...
    'CData',zeros(1,0),...
    'ListboxTop',0,...
    'Position',[0.07 0.42315369261477 0.127829560585885 0.06187624750499],...
    'String','Zero phase rp',...
    'FontSize',12,...
    'Style','text',...
    'UserData',zeros(1,0));

hrdb4 = uicontrol(...
    'Parent',h1,...
    'Units','normalized',...
    'BackgroundColor',[1 1 1],...
    'CData',zeros(1,0),...
    'ListboxTop',0,...
    'Position',[0.201065246338216 0.439121756487026 0.0679094540612517 0.059880239520958],...
    'String',0,...
    'Style','edit',...
    'Tag','rpvalue',...
    'UserData',zeros(1,0));


%% HSVD %%

hsvd1 = uicontrol(...
    'Parent',h1,...
    'Units','normalized',...
    'CData',zeros(1,0),...
    'ListboxTop',0,...
    'Position',[0.314247669773635 0.0978043912175648 0.312916111850866 0.578842315369261],...
    'String',{ '' },...
    'Style','frame',...
    'UserData',zeros(1,0));

hsvd3 = uicontrol(...
    'Parent',h1,...
    'Units','normalized',...
    'CData',zeros(1,0),...
    'FontSize',13,...
    'FontWeight','bold',...
    'ListboxTop',0,...
    'Position',[0.439414114513981 0.602794411177644 0.0878828229027963 0.0698602794411178],...
    'String','HSVD',...
    'Style','text',...
    'UserData',zeros(1,0));
    
hsvd2 = uicontrol(...
    'Parent',h1,...
    'Units','normalized',...
    'CData',zeros(1,0),...
    'FontSize',10,...
    'HorizontalAlignment','left',...
    'ListboxTop',0,...
    'Position',[0.4503328894806924 0.544910179640719 0.0785619174434088 0.0698602794411178],...
    'String','HSVD',...
    'Style','radiobutton',...
    'Tag','hsvd',...
    'UserData',zeros(1,0));

hpeak = uicontrol(...
    'Parent',h1,...
    'Units','normalized',...
    'CData',zeros(1,0),...
    'HorizontalAlignment','right',...
    'ListboxTop',0,...
    'Position',[0.346205059920107 0.447105788423153 0.141145139813582 0.0638722554890219],...
    'String','Number of Peaks',...
    'Style','text',...
    'Tag','npeaks',...
    'UserData',zeros(1,0));

hpeak1 = uicontrol(...
    'Parent',h1,...
    'Units','normalized',...
    'BackgroundColor',[1 1 1],...
    'CData',zeros(1,0),...
    'ListboxTop',0,...
    'Position',[0.500665778961385 0.469061876247505 0.0679094540612517 0.059880239520958],...
    'String',10,...
    'FontSize',12,...
    'Style','edit',...
    'Tag','npeak',...
    'UserData',zeros(1,0));

hcol = uicontrol(...
    'Parent',h1,...
    'Units','normalized',...
    'CData',zeros(1,0),...
    'HorizontalAlignment','right',...
    'ListboxTop',0,...
    'Position',[0.346205059920107 0.333333333333333 0.143808255659121 0.0698602794411178],...
    'String','Number of Points',...
    'Style','text',...
    'UserData',zeros(1,0));

hcol1 = uicontrol(...
    'Parent',h1,...
    'Units','normalized',...
    'CData',zeros(1,0),...
    'FontSize',10,...
    'HorizontalAlignment','left',...
    'ListboxTop',0,...
    'Position',[0.5 0.4 0.068 0.06],...
    'String','Auto',...
    'Style','radiobutton',...
    'Tag','ncolauto',...
    'Value',1,...
    'Callback',[...
        'set(findobj(''Style'',''radiobutton'',''Tag'',''ncolmanual''),''Value'',0);',...  
        'set(findobj(''Style'',''radiobutton'',''Tag'',''ncolauto''),''Value'',1);',...        
        'set(findobj(''Style'',''edit'',''Tag'',''ncol''),''Enable'',''off'');'],...                 
    'UserData',zeros(1,0));

hcol10 = uicontrol(...
    'Parent',h1,...
    'Units','normalized',...
    'CData',zeros(1,0),...
    'FontSize',10,...
    'HorizontalAlignment','left',...
    'ListboxTop',0,...
    'Position',[0.5 0.34 0.09 0.06],...
    'String','Manual',...
    'Style','radiobutton',...
    'Tag','ncolmanual',...
    'Value',0,...
    'Callback',[... 
        'set(findobj(''Style'',''radiobutton'',''Tag'',''ncolmanual''),''Value'',1);',...  
        'set(findobj(''Style'',''radiobutton'',''Tag'',''ncolauto''),''Value'',0);',...  
        'set(findobj(''Style'',''edit'',''Tag'',''ncol''),''Enable'',''on'');'],...                 
    'UserData',zeros(1,0));

hcol2 = uicontrol(...
    'Parent',h1,...
    'Units','normalized',...
    'BackgroundColor',[1 1 1],...
    'CData',zeros(1,0),...
    'ListboxTop',0,...
    'Position',[0.515 0.29 0.065 0.05],...
    'String', 800,...
    'FontSize',12,...    
    'Enable','off',...
    'Style','edit',...
    'Tag','ncol',...
    'UserData',zeros(1,0));

hRoff = uicontrol(...
    'Parent',h1,...
    'Units','normalized',...
    'CData',zeros(1,0),...
    'HorizontalAlignment','right',...
    'ListboxTop',0,...
    'Position',[0.346205059920107 0.193552894211577 0.143808255659121 0.0698602794411178],...
    'String','Receiver Offset (ppm)',...
    'Style','text',...
    'UserData',zeros(1,0));

hRoff1 = uicontrol(...
    'Parent',h1,...
    'Units','normalized',...
    'BackgroundColor',[1 1 1],...
    'CData',zeros(1,0),...
    'ListboxTop',0,...
    'Position',[0.500665778961385 0.215508982035928 0.0679094540612517 0.059880239520958],...
    'String',4.65,...
    'FontSize',12,...
    'Style','edit',...
    'Tag','rxoffset',...
    'UserData',zeros(1,0));

hmagnet = uicontrol(...
    'Parent',h1,...
    'Units','normalized',...
    'CData',zeros(1,0),...
    'HorizontalAlignment','right',...
    'ListboxTop',0,...
    'Position',[0.346205059920107 0.121756487025948 0.143808255659121 0.0798403193612774],...
    'String','Magnet (T)',...
    'Style','text',...
    'UserData',zeros(1,0));

hmagnet1 = uicontrol(...
    'Parent',h1,...
    'Units','normalized',...
    'BackgroundColor',[1 1 1],...
    'Callback',[...
        'magnettype=get(findobj(''Style'',''popupmenu'',''Tag'',''magnet''),''String'');',...
        'magnetvalue=get(findobj(''Style'',''popupmenu'',''Tag'',''magnet''),''Value'');',...
        'magnet=eval(magnettype(magnetvalue,:));'],...
    'ListboxTop',0,...
    'Position',[0.501997336884154 0.135728542914172 0.0972037283621838 0.0638722554890219],...
    'String',[ '  3';'  4' ; '  7'; '9.4' ],...
    'FontSize',12,...
    'Style','popupmenu',...
    'Value',2,...
    'Tag','magnet');


%% SAVE File %%
hsave = uicontrol(...
    'Parent',h1,...
    'Units','normalized',...
    'CData',zeros(1,0),...
    'ListboxTop',0,...
    'Position',[0.0652463382157124 0.0399201596806387 0.210386151797603 0.285429141716567],...
    'String',{ '' },...
    'Style','frame',...
    'UserData',zeros(1,0));

hsave1 = uicontrol(...
    'Parent',h1,...
    'Units','normalized',...
    'CData',zeros(1,0),...
    'FontSize',13,...
    'FontWeight','bold',...
    'ListboxTop',0,...
    'Position',[0.11 0.19 0.12 0.13],...
    'String','OUTPUT',...
    'Style','text',...
    'Tag','output',...
    'UserData',zeros(1,0));

hsave2 = uicontrol(...
    'Parent',h1,...
    'Units','normalized',...
    'CData',zeros(1,0),...
    'FontSize',10,...
    'HorizontalAlignment','left',...
    'ListboxTop',0,...
    'Position',[0.08 0.20 0.08 0.06],...
    'String','RAW',...
    'Style','radiobutton',...
    'Tag','saveraw',...
    'Value',0,...
    'Callback',[...
        'set(findobj(''Style'',''radiobutton'',''Tag'',''savefid''),''Value'',0);'],...    
    'UserData',zeros(1,0));

hsave3 = uicontrol(...
    'Parent',h1,...
    'Units','normalized',...
    'CData',zeros(1,0),...
    'FontSize',10,...
    'HorizontalAlignment','left',...
    'ListboxTop',0,...
    'Position',[0.17 0.20 0.1 0.06],...
    'String','Vnmr FID',...
    'Style','radiobutton',...
    'Tag','savefid',...
    'Value',0,... 
    'Callback',[... 
        'set(findobj(''Style'',''radiobutton'',''Tag'',''saveraw''),''Value'',0);'],...  
    'UserData',zeros(1,0));

hsave4 = uicontrol(...
    'Parent',h1,...
    'Units','normalized',...
    'CData',zeros(1,0),...
    'ListboxTop',0,...
    'Position',[0.11 0.12 0.13 0.06],...
    'String','Save as:',...
    'Style','text',...
    'Tag','savefile',...
    'UserData',zeros(1,0));


hsave5 = uicontrol(...
    'Parent',h1,...
    'Units','normalized',...
    'BackgroundColor',[1 1 1],...
    'CData',zeros(1,0),...
    'ListboxTop',0,...
    'Position',[0.11 0.08 0.15 0.06],...
    'String', 'Mac' ,...
    'FontSize',12,...
    'Style','edit',...
    'Tag','savefilename',...
    'UserData',zeros(1,0));


%% Process %%
hproc = uicontrol(...
    'Parent',h1,...
    'Units','normalized',...
    'CData',zeros(1,0),...
    'ListboxTop',0,...
    'Position',[0.68 0.30 0.22 0.38],...
    'String',{ '' },...
    'Style','frame',...
    'UserData',zeros(1,0));

hproc1 = uicontrol(...
    'Parent',h1,...
    'Units','normalized',...
    'CData',zeros(1,0),...
    'FontSize',13,...
    'FontWeight','bold',...
    'ListboxTop',0,...
    'Position',[0.69 0.62 0.2 0.05],...
    'String','PROCESSING',...
    'Style','text',...
    'UserData',zeros(1,0));
    
hproc2 = uicontrol(...
    'Parent',h1,...
    'Units','normalized',...
    'CData',zeros(1,0),...
    'FontSize',10,...
    'HorizontalAlignment','left',...
    'ListboxTop',0,...
    'Position',[0.74 0.58 0.12 0.05],...
    'String','PROCESS',...
    'Style','radiobutton',...
    'Tag','process',...
    'Value',0,...
    'UserData',zeros(1,0));

hlb= uicontrol(...
    'Parent',h1,...
    'Units','normalized',...
    'CData',zeros(1,0),...
    'HorizontalAlignment','right',...
    'ListboxTop',0,...
    'Position',[0.75 0.5 0.03 0.05],...
    'String','LB',...
    'Style','text',...
    'Tag','lb',...
    'UserData',zeros(1,0));

hlb1 = uicontrol(...
    'Parent',h1,...
    'Units','normalized',...
    'BackgroundColor',[1 1 1],...
    'CData',zeros(1,0),...
    'ListboxTop',0,...
    'Position',[0.8 0.515 0.06 0.04],...
    'String',2,...
    'FontSize',12,...
    'Style','edit',...
    'Tag','lb',...
    'UserData',zeros(1,0));

hgf= uicontrol(...
    'Parent',h1,...
    'Units','normalized',...
    'CData',zeros(1,0),...
    'HorizontalAlignment','right',...
    'ListboxTop',0,...
    'Position',[0.75 0.45 0.03 0.05],...
    'String','GF',...
    'Style','text',...
    'Tag','gf',...
    'UserData',zeros(1,0));

hgf1 = uicontrol(...
    'Parent',h1,...
    'Units','normalized',...
    'BackgroundColor',[1 1 1],...
    'CData',zeros(1,0),...
    'ListboxTop',0,...
    'Position',[0.8 0.465 0.06 0.04],...
    'String',1000,...
    'FontSize',12,...
    'Style','edit',...
    'Tag','gf',...
    'UserData',zeros(1,0));

hzf= uicontrol(...
    'Parent',h1,...
    'Units','normalized',...
    'CData',zeros(1,0),...
    'HorizontalAlignment','right',...
    'ListboxTop',0,...
    'Position',[0.7 0.4 0.08 0.05],...
    'String','Zero-fill',...
    'Style','text',...
    'Tag','gf',...
    'UserData',zeros(1,0));

hzf1 = uicontrol(...
    'Parent',h1,...
    'Units','normalized',...
    'BackgroundColor',[1 1 1],...
    'CData',zeros(1,0),...
    'ListboxTop',0,...
    'Position',[0.8 0.415 0.06 0.04],...
    'String',1,...
    'FontSize',12,...
    'Style','edit',...
    'Tag','zf',...
    'UserData',zeros(1,0));

hampl= uicontrol(...
    'Parent',h1,...
    'Units','normalized',...
    'CData',zeros(1,0),...
    'HorizontalAlignment','right',...
    'ListboxTop',0,...
    'Position',[0.685 0.35 0.11 0.05],...
    'String','TMS amplitude',...
    'Style','text',...
    'Tag','tmsampl',...
    'UserData',zeros(1,0));

hampl1 = uicontrol(...
    'Parent',h1,...
    'Units','normalized',...
    'BackgroundColor',[1 1 1],...
    'CData',zeros(1,0),...
    'ListboxTop',0,...
    'Position',[0.8 0.365 0.06 0.04],...
    'String',1,...
    'FontSize',12,...
    'Style','edit',...
    'Tag','tmsampl',...
    'UserData',zeros(1,0));

hht= uicontrol(...
    'Parent',h1,...
    'Units','normalized',...
    'CData',zeros(1,0),...
    'HorizontalAlignment','right',...
    'ListboxTop',0,...
    'Position',[0.685 0.305 0.11 0.05],...
    'String','Amplitude',...
    'Style','text',...
    'Tag','Crheight',...
    'UserData',zeros(1,0));

hht1 = uicontrol(...
    'Parent',h1,...
    'Units','normalized',...
    'BackgroundColor',[1 1 1],...
    'CData',zeros(1,0),...
    'ListboxTop',0,...
    'Position',[0.8 0.315 0.06 0.04],...
    'String',1,...
    'FontSize',12,...
    'Style','edit',...
    'Tag','Crheight',...
    'UserData',zeros(1,0));

%% Run %%
hrun = uicontrol(...
    'Parent',h1,...
    'Units','normalized',...
    'CData',zeros(1,0),...
    'FontSize',14,...
    'ListboxTop',0,...
    'Position',[0.695 0.14 0.19 0.15],...
    'String','RUN',...
    'Tag','run',...
    'Callback',[...
        'datadir=(get(findobj(''Style'',''edit'',''Tag'',''filename''),''String''));',...
        'createrdbflag=get(findobj(''Style'',''radiobutton'',''Tag'',''createrdb''),''Value'');',...
        'hsvdflag=get(findobj(''Style'',''radiobutton'',''Tag'',''hsvd''),''Value'');',...
        'rawflag=get(findobj(''Style'',''radiobutton'',''Tag'',''saveraw''),''Value'');',...
        'savefid=get(findobj(''Style'',''radiobutton'',''Tag'',''savefid''),''Value'');',...      
        'npeak=eval(get(findobj(''Style'',''edit'',''Tag'',''npeak''),''String''));',...    
        'rp=eval(get(findobj(''Style'',''edit'',''Tag'',''rpvalue''),''string''));',...       
        'rawfile=(get(findobj(''Style'',''edit'',''Tag'',''savefilename''),''String''));',...   
        'receiveroffset=eval(get(findobj(''Style'',''edit'',''Tag'',''rxoffset''),''String''));',...      
        'magnettype=get(findobj(''Style'',''popupmenu'',''Tag'',''magnet''),''String'');',...
        'magnetvalue=get(findobj(''Style'',''popupmenu'',''Tag'',''magnet''),''Value'');',...
        'magnet=eval(magnettype(magnetvalue,:));',...    
        'lb=eval(get(findobj(''Style'',''edit'',''Tag'',''lb''),''string''));',...               
        'gf=eval(get(findobj(''Style'',''edit'',''Tag'',''gf''),''string''));',...                       
        'sifactor=eval(get(findobj(''Style'',''edit'',''Tag'',''zf''),''string''));',...                           
        'tmsampl=eval(get(findobj(''Style'',''edit'',''Tag'',''tmsampl''),''string''));',...                       
        'rmampl=eval(get(findobj(''Style'',''edit'',''Tag'',''Crheight''),''string''));',...                       
        'if (get(findobj(''Style'',''radiobutton'',''Tag'',''ncolauto''),''value''))==1;',...
        'ncol=0; else ncol=eval(get(findobj(''Style'',''edit'',''Tag'',''ncol''),''String'')); end;',...            
        'if isempty(datadir)==1; disp(''Path not specified''); return; end; ',...
	'processflag=get(findobj(''Style'',''radiobutton'',''Tag'',''process''),''Value'');',...
        'if (createrdbflag==0 & hsvdflag==0 & processflag==0); disp(''Nothing to execute... ''); return; end; ',...        
	'peakremovalgui(createrdbflag,hsvdflag,datadir,rp,npeak,ncol,receiveroffset,magnet,rawflag,savefid,rawfile,lb,gf,sifactor,tmsampl,rmampl)'],...
        'UserData',zeros(1,0));

%% Exit %%
hexit = uicontrol(...
    'Parent',h1,...
    'Units','normalized',...
    'Callback','clear all; close all',...
    'CData',zeros(1,0),...
    'FontSize',10,...
    'ListboxTop',0,...
    'Position',[0.73 0.04 0.12 0.09],...
    'String','Exit',...
    'Tag','pushbutton16',...
    'UserData',zeros(1,0));

return


